<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User">
	<select id="rightUserSelectemail" resultType="User">
		select * from user_info where uemail = #{uemail}
	</select>
	<select id="rightUserSelect" resultType="User">
		select * from user_info where ucode = #{ucode}
	</select>
	<!-- change_info에 바뀐 데이터 insert -->
	<insert id="rightUserEdit1" parameterType="User">
		insert into change_info 
							values(to_char(sysdate,'yyyy/mm/dd hh24:mi:ss'),#{ucode},
									null,null,null,null,null,null,null,null,
									#{uatid},null,to_date(#{ubirth}, 'yyyy/mm/dd'),#{ugender},#{unation},null )
	</insert>
	<!-- change_info에 기존 데이터 update -->
	<update id="rightUserEdit2" parameterType="User">
		update change_info c set (cid, cbirth, cgender, cnation ) 
						= (select uatid,ubirth,ugender,unation 
						 from user_info ui 
						 where ui.ucode = #{ucode}) 
		where c.ucode = #{ucode}
	</update>
	<!-- user_info에 바뀐 데이터 update -->
	<update id="rightUserEdit3" parameterType="User">
		update user_info set uatid = #{uatid},
							 ubirth = #{ubirth},
							 ugender = #{ugender},
							 unation = #{unation},
							 uprivate = #{uprivate},
							 ualarm   = #{ualarm}				 
		where ucode=#{ucode}
	</update>
	<!-- id check ajax가 하고싶었다... -->
	<select id="checkId" parameterType="String" resultType="int">
		select count(*) from user_info where uatid = #{uatid}
	</select>
	<!-- change_info에 바뀐 데이터 insert -->
	<insert id="rightUserDisabl" parameterType="User">
		insert into change_info 
							values(to_char(sysdate,'yy/mm/dd hh24:mi:ss'),#{ucode},
									null,null,null,null,null,null,1,null,
									null,null,null,null,null,0 )
	</insert>
	<!-- 회원 탈퇴 user_info ustate = 0으로 업데이트 -->
	<update id="rightUserDisabl1" parameterType="User">
		update user_info set ustate = 0			 
		where ucode=#{ucode}
	</update>
	<!-- 회원 탈퇴  ustate = 0으로 업데이트 -->
	<update id="rightUserDisabl2" parameterType="User">
		update board set ubpremission = 'Nobody' 
		where ucode = #{ucode}
	</update>
	<!-- 회원 탈퇴 change_info ustate = 0으로 업데이트 -->
	<update id="rightUserDisabl3" parameterType="User">
		update user_info set ustate = 0			 
		where ucode=#{ucode}
	</update>
</mapper>