<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="User_info">
	<select id="rightUserSelect" resultType="User_info">
		select * from user_info where ucode = #{ucode}
	</select>
	<!-- change_info에 바뀐 데이터 insert -->
	<insert id="rightUserEdit1" parameterType="User_info">
		insert into change_info 
							values(to_char(sysdate,'yyyy/mm/dd hh24:mi:ss'),#{ucode},
									null,null,null,null,null,null,null,null,
									#{uatid},null,to_date(#{ubirth}, 'yyyy/mm/dd'),#{ugender},#{unation},null )
	</insert>
	<!-- change_info에 기존 데이터 update -->
	<update id="rightUserEdit2" parameterType="User_info">
		update change_info c set (cid, cbirth, cgender, cnation ) 
						= (select uatid,ubirth,ugender,unation 
						 from user_info ui 
						 where ui.ucode = #{ucode}) 
		where c.ucode = #{ucode}
	</update>
	<!-- user_info에 바뀐 데이터 update -->
	<update id="rightUserEdit3" parameterType="User_info">
		update user_info set uatid = #{uatid},
							 ubirth = #{ubirth},
							 ugender = #{ugender},
							 unation = #{unation},
							 uprivate = #{uprivate}							 
		where ucode=#{ucode}
	</update>
	<select id="checkId" resultType="int">
		select count(*) from user_info where uatid = #{uatid}
	</select>
</mapper>