<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.bom.dao.iron.BoardDao">
	<select id="timelineBoardList" parameterType="int"
		resultType="com.spring.bom.model.iron.Board">
		select loginUcode, uimage, ucode, uatid, unickName, bcode, bcontent,
  		  case when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))/365) >=1 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))/365)||'년 전'
     		when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))/31) >=1 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))/31)||'달 전'
     		when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))) >=1 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss')))||'일 전'
     		when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24) >=1 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24)||'시간 전'
     		when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24*60) >=1 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24*60)||'분 전'
     		when trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24*60*60) >=0 then trunc((sysdate - to_date(bregdate,'yy/mm/dd hh24:mi:ss'))*24*60*60)||'초 전'
    	  end as bregdate       
		FROM
     	(
      		select
           		 ui.ucode loginUcode, ui.uimage uimage, b.ucode ucode,
           		 ui.uatid uatid, ui.unickname unickName, b.bcode bcode, b.bcontent bcontent, b.bregdate
          	from
            	 user_info ui, board b, follow f
          	where f.ucode = #{ucode}
          
            and (f.fopcode=b.ucode)
            and b.ucode = ui.ucode
       UNION
       		select
            	 ui.ucode loginUcode, ui.uimage uimage, b.ucode ucode,
            	 ui.uatid uatid, ui.unickname unickName, b.bcode bcode, b.bcontent bcontent, b.bregdate
            from
            	 user_info ui, board b
          	where ui.ucode = #{ucode}
            	 and b.ucode = ui.ucode
      	)
		<!-- select
		ui.ucode, b.ucode, ui.uatid, ui.unickname, b.bcode, b.bcontent
		from
		user_info ui, board b, follow f
		where f.ucode=21
		and (f.ucode=b.ucode or f.fopcode=b.ucode)
		and b.ucode = ui.ucode
		order by b.bregdate; -->
	</select>
</mapper>